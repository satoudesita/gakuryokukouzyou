<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ËäãËô´„Ç≤„Éº„É† - „Ç¥„Éº„É´Âà§ÂÆö‰ªò„Åç</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #87ceeb 0%, #b0e0ff 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      user-select: none;
      font-family: sans-serif;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-template-rows: repeat(10, 40px);
      gap: 4px;
      background-color: transparent;
      padding: 6px;
      border-radius: 12px;
    }
    .cell {
      width: 40px;
      height: 40px;
      position: relative;
      transition: background-color 0.2s ease;
    }
    .green {
      background-color: #4caf50;
      border-radius: 50%;
      box-shadow: inset 0 4px 6px #3b7a3b, 0 0 6px #3b7a3baa;
    }
    .green.head::before {
      content: '';
      position: absolute;
      top: 4px;
      left: 12px;
      width: 4px;
      height: 10px;
      background: #3b7a3b;
      border-radius: 2px;
      box-shadow: 12px 0 #3b7a3b;
    }
    .brown {
      background-color: #c2a669;
    }
    .red {
      background-color: #e53e3e;
      border-radius: 50%;
      box-shadow: inset 0 3px 5px #b23030, 0 0 8px #ff6060aa;
    }
    .goal {
      background-color: #3b82f6;
      border-radius: 10px;
      box-shadow: 0 0 8px #3b82f6aa;
    }
    #message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #28a745;
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: bold;
      display: none;
      z-index: 1000;
      user-select: none;
      box-shadow: 0 0 10px #28a745aa;
    }
  </style>
</head>
<body>

<div id="grid"></div>
<div id="message">„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ</div>

<script>
  const rows = 10;
  const cols = 10;
  const grid = document.getElementById("grid");

  // 0: Á©∫ÁôΩ, 1: Âúü, 2: „É™„É≥„Ç¥, 3: „Ç¥„Éº„É´
  const map = [
    [0,0,0,0,2,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,3,0,0,0],
    [0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,0],
    [0,0,0,0,0,0,1,0,0,0],
    [0,0,0,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1,1]  // ‚Üê „Ç¥„Éº„É´„Éñ„É≠„ÉÉ„ÇØ (3)
  ];

  const cells = [];
  for (let i = 0; i < rows * cols; i++) {
    const cell = document.createElement("div");
    cell.className = "cell";
    grid.appendChild(cell);
    cells.push(cell);
  }

  // ËäãËô´„ÅÆ‰Ωì„ÅÆÂ∫ßÊ®ôÔºàÂÖàÈ†≠„ÅåÈ†≠Ôºâ
  let positions = [
    { row: 8, col: 3 },
    { row: 8, col: 2 },
    { row: 8, col: 1 },
    { row: 8, col: 0 },
  ];

  let hasRed = false; // üçé „ÇíÂèñÂæó„Åó„Åü„Åã
  let isCleared = false; // „ÇØ„É™„Ç¢Ê∏à„Åø„Éï„É©„Ç∞

  function drawBlock() {
    cells.forEach(cell => {
      cell.className = "cell";
    });

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const cell = cells[r * cols + c];
        if (map[r][c] === 1) {
          cell.classList.add("brown");
        } else if (map[r][c] === 2) {
          cell.classList.add("red");
        } else if (map[r][c] === 3) {
          cell.classList.add("goal");
        }
      }
    }

    positions.forEach((pos, idx) => {
      const cell = cells[pos.row * cols + pos.col];
      cell.classList.add("green");
      if (idx === 0) {
        cell.classList.add("head");
      }
    });
  }

  function isBlocked(row, col, isHead) {
    if (row < 0 || row >= rows || col < 0 || col >= cols) return true;

    const cellType = map[row][col];
    if (cellType === 1) return true; // Âúü

    if (cellType === 3) {
      if (!hasRed) return true; // „É™„É≥„Ç¥Êú™ÂèñÂæóÊôÇ„ÅØ„Ç¥„Éº„É´„Å´ÂÖ•„Çå„Å™„ÅÑ
      if (!isHead) return true; // È†≠‰ª•Â§ñ„Åå„Ç¥„Éº„É´„Å´ÂΩì„Åü„Çã„ÅÆ„ÇÇNG
    }

    return false;
  }

  function isRed(row, col) {
    return map[row]?.[col] === 2;
  }

  // „ÇØ„É™„Ç¢Âà§ÂÆöÔºàÈ†≠„Å†„Åë„Åå„Ç¥„Éº„É´„Éû„Çπ‰∏ä„ÅãÔºâ
  function checkClear() {
    if (!hasRed) return;

    const head = positions[0];
    if (map[head.row][head.col] === 3 && !isCleared) {
      isCleared = true;
      document.getElementById("message").style.display = "block";
    }
  }

  document.addEventListener("keydown", (e) => {
    if (isCleared) return;

    const head = { ...positions[0] };
    let nextHead = { ...head };

    if (e.key === "ArrowRight") nextHead.col += 1;
    else if (e.key === "ArrowLeft") nextHead.col -= 1;
    else if (e.key === "ArrowDown") nextHead.row += 1;
    else if (e.key === "ArrowUp") nextHead.row -= 1;
    else return;

    // ÁßªÂãïÂÖà„ÅåËäãËô´„ÅÆ‰Ωì or „Éñ„É≠„ÉÉ„ÇØ or „Ç¥„Éº„É´ÔºàÊù°‰ª∂„Å§„ÅçÔºâ„Å™„ÇâÈÄ≤„Åæ„Å™„ÅÑ
    if (positions.slice(1).some(p => p.row === nextHead.row && p.col === nextHead.col)) return;
    if (isBlocked(nextHead.row, nextHead.col, true)) return;

    positions.unshift(nextHead);
    positions.pop();

    drawBlock();

    checkClear();
  });

  function applyGravity() {
    if (isCleared) return;

    const nextPositions = positions.map((pos, idx) => ({
      row: pos.row + 1,
      col: pos.col
    }));

    const blocked = nextPositions.some((pos, idx) => {
      return isBlocked(pos.row, pos.col, idx === 0);
    });

    if (!blocked) {
      positions = nextPositions;
      drawBlock();
    }
  }

  function checkRedEat() {
    const head = positions[0];
    if (isRed(head.row, head.col)) {
      map[head.row][head.col] = 0;
      hasRed = true;
      const tail = positions[positions.length - 1];
      positions.push({ row: tail.row, col: tail.col });
      drawBlock();
    }
  }

  setInterval(() => {
    applyGravity();
    checkRedEat();
    checkClear();
  }, 80);

  drawBlock();
</script>

</body>
</html>
